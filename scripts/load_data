#!/bin/bash

#set -x

missing_file=false
data_police_home="$PWD"

echo

if [ -z "${1}" ]; then

  echo "Missing file to unzip"
  missing_file=true

else

  zip_file="${1}.zip"

fi

if [ -z "${2}" ]; then
  
  echo "Missing Neo4j home directory."
  missing_file=true

else

  neo4j_home="${HOME}/release/${2}"

fi

if [ "${missing_file}" = true ]; then

  echo "Usage: ${0} YYYY-MM neo4j-home"
  echo "       YYYY       - year"
  echo "       MM         - month"
  echo "       neo4j-home - home directory for Neo4j"
  echo
  echo "Example: ${0} 2020-02 403"
  echo

  exit 

fi
  
cd data
if [ -f "${zip_file}" ]; then

  echo
  echo "unzipping ${zip_file}"
  echo 
  #unzip "${zip_file}"

else

  echo 
  echo "The file ${zip_file} does not exist."
  echo 

fi

echo 
echo
echo "Loading data..."
echo

for load_dir in $( ls -d 20*/ )
do
  cd ${data_police_home}/data/${load_dir}
  for file_to_load in $( ls *csv ) 
  do
    echo "cp ${file_to_load} ${neo4j_home}/import/${file_to_load}"
  done
done

exit 0
